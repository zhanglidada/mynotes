## ACID
- 原子性
- 一致性
- 隔离性
- 持久性

## 隔离级别
1.读未提交--脏读
    B事务update，但是rollback，A事务在B回滚之前读取数据，读到了脏数据

2.读已提交--不可重复读
    B事务update，commit
    A事务在Bcommit之前和commit之后读取的数据是不一样的，存在不可重复读

3.可重复读，mysql默认级别--幻读
    moeny = 99
    B 事务开始
    B update momeny = 77
    A 事务开始
    A 查询moeny == 99
    此时B事务提交
    A查询money还是99
    此时如果A事务提交之后，A查询money就是77了。。这就是幻读

    只要A事务没结束的话，其他事务影响不到A事务，但是提交之后就不行了。解决了不可重复读，但是会有幻读

4.串行化
    A开事务查询时候
    B开事务update
    A可以读但是不可以写，因为被锁住了

查看数据库默认的隔离级别 select @@tx_isolation
设置数据库隔离级别 set tx_isolation='read-uncommitted' 读未提交

##InnoDB锁的原理
    协调并发访问某一个资源
1.共享锁
    s锁，读锁
    多个事务对同一个资源共享，但是只能读，不能修改
    A拿到共享锁，B不能修改
2.排他锁
    x锁，写锁
    不能与其他锁共存，一个写，连读也不能读
    ## innoDB行锁，锁的是什么（匹配到条件会上行锁）
        其实就是给索引上的索引项上锁，如果没有索引，就会上表锁
        所以应该建立合适的索引，提高并发性能
3.意向共享锁
    is
    获得共享锁之前，先获得表的意向共享锁
    意向锁可以优化锁之间的性能
4.意向排他锁
    ix
    获得排他锁之前，先获得表的意向排他锁
    ## 没有意向锁，行锁和表锁不能共存
        事务A锁住一行（行锁），事务B锁住整个表（表锁）
        如果没有意向排他锁
        事务A锁住一行，那么这行不能被其他事务修改
        事务B锁住表，那么事务B能修改表中任意项
        事务A和事务B是冲突的
    ## 意向锁如何让行锁和表锁共存
        事务A在申请行锁（写锁之前），数据库会自动给事务申请表的意向排他锁
        事务B申请表的写锁的时候就会失败，因为表上有意向排他锁之后，B申请写锁会被阻塞
            意向锁的作用就是：
                当一个事务在需要获取资源的锁定时，先获取意向锁，如果不能获取意向锁则阻塞
                优化锁操作，进行快速返回
5.自增锁
    没有提交的id会丢失，比如我现在1 2，插入五条数据
    回滚
    再插入一条，我现在的id：1 2 8
6.临键锁（左开右闭）（为了防止多个事务把记录插到同一个范围内去防止幻读）
    当前id：1 2 3 4 14 30 60 90 222 330
    范围查询，select * form account where id > 14 and id < 35 for update
    另一个事务插入，insert into account (id,name,moeny) values(15,"zz",11);
    当前范围查询的范围锁住了，所以id为15是不能插入的
    InnoDB底层是B+树实现的，所以目前锁住的是14--60之间节点
    * 记录锁与间隙锁组合起来用就叫做Next-Key Lock，就是将键及其两边的的间隙加锁（向左扫描扫到第一个比给定参数小的值， 向右扫描扫描到第一个比给定参数大的值， 然后以此为界，构建一个区间
7.间隙锁
    当前id：1 2 3 4 14 15 30 60 90 222 330
    如果范围查询没有匹配记录，select * form account where id > 100 and id < 200 for update
    此时的区间在90--222之间，节点区间范围内有排他锁
    没有匹配上会退化成间隙锁
    * 锁加在不存在的空闲空间，可以是两个索引记录之间，也可能是第一个索引记录之前（负无穷，first-key）或最后一个索引之后(last-key，正无穷）的无限空间
8.记录锁
    锁精准的加到某一行上

## 隔离级别和锁之间的关系

## 脏读的解决
    用排他锁可以解决
## 不可重复读
    其他事务修改之后，读前和读后结果不一样
    事务在读前上共享锁
## 幻读
    临界锁可以解决
